# 工作日志

## ~12.8

### 几步尝试

#### 1.使用mirai原生的java开发，通过第三方管理。

结果及问题：

（1）可以进行登录，并且监听对话

（2）登录多次以后就会登录不成功，每次登录都要验证码，疑似其自带前端有问题。

（3）java开发过于笨重。

#### 2.使用使用miraiok+官方golang的sdk。

结果及问题：

（1）可以成功登录，并且输入一次验证码后无需再次输入。

（2）无法通过url发送图片，其提供的多个api均失效，通过postman测试发现是它的api有问题，只能弃用。

（3）官方写的sdk太烂，没有注释，只能通过demo一点点摸，开发效率极底，不能通过url发图片导致必须通过先从网页下载，再从本地发送图片的方式，非常低效。

（4）官方提供的sdk没有自带的异步模式，需要自己对文件管理加锁啥的，导致写出来的东西最后非常地shit山。

（5）每次对话都要检验sessionkey,并且还时不时要考虑它是否失效。

（6）Miraiok没有实现websocket，交互起来蛋疼。

#### 3.使用go-cqhttp

（1）很好地通过url发出了图片了！！！！！

（2）通过url发图片只能必须在非公网条件下（校园网不行），原因未知，可能墙掉了某些东西，每次发都

error 500，通过postman测试其api大多没有问题，功能非常非常非常丰富。

（3）为什么是go-cqhttp?go-cqhttp的优点是？

①支持CQ码，也就是说复杂的json表单可以换成简单的短短一行的CQ码来表示，同时CQ码支持了大多数功能，包括点歌，包括url发图片，包括发cardimage-超大图片，包括抢红包（对，只能抢），发礼物，戳一戳，@，发送xml格式内容and so on。

②可控，稳定，登录正常，一次验证以后无需重复登录，各种配置文件比较清晰明朗，不像miraiok那样混乱，并且最近仍然在持续更新。

③大部分功能完善，支持websocket对话，比起http体验更还好？？？？其实我也不清楚，听说是这样子的）

④建立对话后不用再进行繁琐的验证sessionkey操作。

#### 4.使用go-cqhttp+[nonebot](https://docs.nonebot.dev/guide/)

（1）人生苦短，我学python！nonebot非常简洁轻巧，自带的支持异步，并发，支持websocket，而且其官方文档提供了一整套有关自然语言处理的方案，可以更好的实现交互，而且语法简洁，包管理轻松。

（2）中间出现了websocket连了好久连不上的毛病，怀疑是nonebot版本和go-cqhttp不兼容，卸载nonebot2换成nonebot1以后解决。

（3）墙裂推荐蓝链的文档。

#### 5.目前实现的功能

可以发送随机图片，可以检索对应关键字查询天气信息（要配合爬虫爬中国天气网啥的，暂时没完善，不过对文字处理的部分已经完成）

#### 6.总结

基本摸清前期所有配置工作，踩了一堆雷，这玩意看来烦的是理解和前期配置，现在基本进入可以模块化编程的步骤，接下来工作应该就是日常维护加上时不时加点小功能上去就行，码量很小就只能报告凑数了orz。

​		







